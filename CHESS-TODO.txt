Chess Feature - Task Tracking
=====================================

## Phase 1: Hub Page & Restructure [IN PROGRESS]

- [x] Replace "Tactics" and "Play" nav entries with single "Chess" link
- [x] Convert /chess/ from leaf bundle to section (hub page)
- [x] Create chess hub layout with links to all sub-pages
- [x] Move puzzles to /chess/puzzles/
- [x] Move play to /chess/play/
- [x] Create placeholder pages for Learn and Openings
- [x] Fix conditional CSS/JS loading for new structure
- [ ] Add hub page CSS (styled links with descriptions)

## Phase 2: Puzzles (expand existing)

- [x] 15 puzzles across 5 tactical categories (Lichess-sourced)
- [ ] Add puzzle difficulty ratings display
- [ ] Add puzzle navigation (next/previous) with wrap-around
- [ ] Add more puzzles (aim for 5-8 per category)
- [ ] Track puzzle solve stats in localStorage
- [ ] Add pawn promotion UI (currently auto-queens)

## Phase 3: Learn — Tactical Lessons [DONE — first 4 lessons]

Interactive lesson system with step-through board positions.
First batch of 4 lessons shipped; infrastructure supports adding more.

Shipped lessons:
  1. [x] Piece value & trading      — when to exchange, material advantage
  2. [x] Controlling the centre     — why centre squares matter, pawn structure
  3. [x] Forks                      — double attacks, knight forks especially
  4. [x] Pins & skewers             — absolute vs relative pins, skewer patterns

Infrastructure (all done):
- [x] Short text explanation (~2-3 paragraphs) per lesson
- [x] 2-3 interactive board positions per lesson
- [x] Step-through mode with annotated moves
- [x] JSON data format (data/chesslessons.json)
- [x] Dedicated layout (chess-learn/single.html) + JS (chess-learn.js)
- [x] Progress tracking in localStorage
- [x] Reuses chess engine for FEN parsing

Future lessons (not yet built):
  5. Development & tempo            — getting pieces out, not moving same piece twice
  6. King safety & castling         — when and why to castle, pawn shield
  7. Discovered attacks             — moving one piece to unleash another
  8. Back rank mates                — the classic trapped-king pattern
  9. Mating patterns                — smothered mate, Arabian mate, support mate
  10. Putting it together           — combining tactics in real positions

## Phase 4: Openings — Drillable Sequences [IN PROGRESS — first opening done]

Interactive opening trainer. Player drills move sequences
until they become muscle memory.

Infrastructure (all done):
- [x] Data format: flat JSON move array with annotations (data/chessopenings.json)
- [x] Board UI: player makes the "right" move, opponent auto-responds
- [x] Wrong move feedback: shake animation, error counted, player retries
- [x] Drill mode: track accuracy per attempt, save best to localStorage
- [x] Layout: chess board + move list + opening name/description (chess-openings/single.html)
- [x] Stats: track drill accuracy and attempts in localStorage
- [x] "You play as Black/White" indicator

Shipped openings:
  1. [x] Caro-Kann (black) — 1.e4 c6 2.d4 d5 main line, 10 moves per side

Future openings (not yet built):
- [ ] Ruy Lopez (white) — 1.e4 e5 2.Nf3 Nc6 3.Bb5 (main line + common responses)
- [ ] Italian Game (white) — 1.e4 e5 2.Nf3 Nc6 3.Bc4
- [ ] Sicilian Defence (black) — 1.e4 c5
- [ ] Queen's Gambit (white) — 1.d4 d5 2.c4

Future enhancements:
- [ ] Variation branches: after main line, drill common deviations
- [ ] Hint button: highlight the correct source/target square

## Phase 5: Polish & Future

- [ ] Keyboard navigation for accessibility (all chess pages)
- [ ] Animation for piece movement
- [ ] Shared chess engine improvements (promotion UI, etc.)
- [ ] Add more openings (Italian, Sicilian, Queen's Gambit, etc.)
- [ ] Add more lessons (endgame basics, pawn structure, etc.)

## Done (historical)

- [x] Learn page: 4 interactive lessons with step-through boards & localStorage progress
- [x] Scaffold files: content page, layout, CSS, JS, puzzle data
- [x] Implement chess board rendering (FEN parser, Unicode pieces)
- [x] Implement move validation for all piece types
- [x] Implement check/checkmate detection
- [x] Implement puzzle solution flow (validate moves, auto-reply, solved state)
- [x] Add reset and hint buttons
- [x] Add move history log
- [x] Style for all 4 themes (pistachio, matrix, light, dark)
- [x] Responsive layout (480px breakpoint)
- [x] Conditional CSS/JS loading (only on chess pages)
- [x] Add castling support (engine + play mode)
- [x] Add en passant support (engine + play mode)
- [x] Add stalemate detection (engine + play mode)
- [x] Local 2-player Play page with turn management, undo, new game

## Process Log: Categorized Puzzles (Feb 2026)

How we built the tactics tutorial with Claude Code:

1. **Planning phase** — Designed data structure (flat array -> categories object),
   identified 5 tactical themes (back rank mates, forks, pins/skewers, discovered
   attacks, mating patterns), and mapped out all files to change.

2. **First attempt: hand-crafted puzzles** — Claude initially tried to create 15
   puzzles from scratch by constructing FEN positions and solutions manually.
   Several had incorrect positions (wrong squares attacked, impossible mates,
   pieces on wrong diagonals). Caught during careful verification of each puzzle.

3. **Pivot to Lichess database** — User suggested using the Lichess open puzzle
   database (database.lichess.org). Streamed the 5.7M puzzle CSV via curl+zstd,
   filtered by theme tags (backRankMate, fork, pin, skewer, discoveredAttack,
   smotheredMate, arabianMate), rating (<1400), and popularity (>80%).

4. **Conversion pipeline** — Wrote a Python script to convert Lichess format to
   ours: applied the setup move to get the puzzle-start FEN, converted UCI moves
   (e.g. "e2e4") to algebraic notation, and structured into our JSON schema.

5. **Implementation** — Updated 5 files:
   - `data/chesspuzzles.json` — 15 verified puzzles in 5 categories
   - `layouts/chess/single.html` — added category `<select>` and description
   - `assets/js/chess.js` — category state, helpers, dropdown listener
   - `assets/css/chess.css` — category bar styling with CSS vars
   - `content/chess/index.md` — updated title and intro text

6. **Verification** — Hugo build passes, JSON validates, all puzzles sourced
   from real games played on Lichess.
