/* ============================================
   Virtual Pet
   ============================================ */
.pet-container {
  position: fixed;
  z-index: 9999;
  pointer-events: auto;
  cursor: grab;
  image-rendering: pixelated;
  transition: none;
}

.pet-container.pet-dragging {
  cursor: grabbing;
}

.pet-container.pet-following {
  transition: left 0.15s ease-out, top 0.15s ease-out;
}

.pet-container.pet-farming-walk {
  transition: left 0.8s ease-in-out, top 0.8s ease-in-out;
}

.pet-sprite {
  width: 48px;
  height: 48px;
  position: relative;
}

.pet-pixel-canvas {
  position: absolute;
  top: 0;
  left: 0;
}

/* ── Idle bob animation ────────────────────── */
.pet-state-idle .pet-sprite {
  animation: pet-bob 2s ease-in-out infinite;
}

@keyframes pet-bob {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-3px); }
}

/* ── Celebrate jump ────────────────────────── */
.pet-state-celebrating .pet-sprite {
  animation: pet-jump 0.4s ease-in-out 3;
}

@keyframes pet-jump {
  0%, 100% { transform: translateY(0); }
  40% { transform: translateY(-12px); }
}

/* ── Sad droop ─────────────────────────────── */
.pet-state-sad .pet-sprite {
  animation: pet-droop 1.5s ease-in-out infinite;
}

@keyframes pet-droop {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(2px); }
}

/* ── Sleep Zzz ─────────────────────────────── */
.pet-state-sleeping .pet-sprite {
  animation: pet-sleep-bob 3s ease-in-out infinite;
}

@keyframes pet-sleep-bob {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(1px); }
}

.pet-zzz {
  position: absolute;
  top: -14px;
  right: -8px;
  font-size: 10px;
  color: var(--foreground);
  opacity: 0;
  animation: pet-zzz-float 2s ease-in-out infinite;
  pointer-events: none;
}

@keyframes pet-zzz-float {
  0% { opacity: 0; transform: translateY(0); }
  30% { opacity: 0.7; }
  100% { opacity: 0; transform: translateY(-10px); }
}

/* ── Flung spin ────────────────────────────── */
.pet-state-flung .pet-sprite {
  animation: pet-spin 0.3s linear infinite;
}

@keyframes pet-spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* ── Speech Bubble ─────────────────────────── */
.pet-speech {
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--background);
  color: var(--foreground);
  border: 1px solid var(--foreground);
  padding: 4px 8px;
  font-size: 11px;
  font-family: inherit;
  white-space: nowrap;
  pointer-events: none;
  max-width: 200px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.pet-speech::after {
  content: '';
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border: 4px solid transparent;
  border-top-color: var(--foreground);
}

/* ── Spawn animation ──────────────────────── */
.pet-spawning {
  pointer-events: none;
}

.pet-spawning .pet-sprite {
  animation: pet-spawn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards !important;
}

@keyframes pet-spawn {
  0% { opacity: 0; transform: scale(0) rotate(-30deg); filter: brightness(3); }
  30% { opacity: 1; transform: scale(1.3) rotate(5deg); filter: brightness(2); }
  50% { transform: scale(0.9) rotate(-3deg); filter: brightness(1.2); }
  70% { transform: scale(1.1) rotate(1deg); filter: brightness(1); }
  100% { opacity: 1; transform: scale(1) rotate(0deg); filter: brightness(1); }
}

/* Glow ring behind pet during spawn */
.pet-spawn-glow {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 80px;
  height: 80px;
  margin: -40px 0 0 -40px;
  border-radius: 50%;
  pointer-events: none;
  animation: pet-spawn-ring 0.8s ease-out forwards;
}

@keyframes pet-spawn-ring {
  0% { opacity: 0.8; transform: scale(0); box-shadow: 0 0 20px 10px var(--accent); }
  50% { opacity: 0.5; transform: scale(1.2); box-shadow: 0 0 30px 15px var(--accent); }
  100% { opacity: 0; transform: scale(2); box-shadow: 0 0 0px 0px var(--accent); }
}

/* Sparkle particles */
.pet-spawn-sparkle {
  position: fixed;
  z-index: 10001;
  width: 4px;
  height: 4px;
  background: var(--accent);
  pointer-events: none;
  border-radius: 50%;
  animation: pet-sparkle-fly 0.7s ease-out forwards;
}

@keyframes pet-sparkle-fly {
  0% { opacity: 1; transform: translate(0, 0) scale(1); }
  100% { opacity: 0; transform: translate(var(--sx), var(--sy)) scale(0); }
}

/* ── Coin particle ─────────────────────────── */
.pet-coin-particle {
  position: fixed;
  z-index: 10000;
  font-size: 12px;
  pointer-events: none;
  animation: pet-coin-fly 0.8s ease-out forwards;
}

@keyframes pet-coin-fly {
  0% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-30px); }
}

/* ── Mobile: match 16×3 scale ─────────────── */
@media (max-width: 768px) {
  .pet-sprite {
    width: 48px;
    height: 48px;
  }
}

/* ── Pet teleporter pad ──────────────────────────── */
.pet-teleporter {
  position: fixed;
  bottom: 12px;
  right: 12px;
  width: 64px;
  height: 64px;
  z-index: 9998;
  cursor: pointer;
  clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
  background: color-mix(in srgb, var(--accent) 10%, transparent);
  animation: teleporter-idle-pulse 3s ease-in-out infinite;
}

.pet-teleporter-pad {
  position: absolute;
  top: 50%;
  left: 50%;
  width: 8px;
  height: 8px;
  margin: -4px 0 0 -4px;
  border-radius: 50%;
  background: var(--accent);
  opacity: 0.5;
  box-shadow: 0 0 6px var(--accent);
}

@keyframes teleporter-idle-pulse {
  0%, 100% {
    box-shadow: inset 0 0 8px color-mix(in srgb, var(--accent) 15%, transparent);
  }
  50% {
    box-shadow: inset 0 0 16px color-mix(in srgb, var(--accent) 30%, transparent);
  }
}

.pet-teleporter-away {
  animation: teleporter-away-pulse 1.5s ease-in-out infinite;
  background: color-mix(in srgb, var(--accent) 20%, transparent);
}

.pet-teleporter-away .pet-teleporter-pad {
  opacity: 0.9;
  box-shadow: 0 0 10px var(--accent), 0 0 20px color-mix(in srgb, var(--accent) 40%, transparent);
}

@keyframes teleporter-away-pulse {
  0%, 100% {
    box-shadow: inset 0 0 12px color-mix(in srgb, var(--accent) 25%, transparent);
  }
  50% {
    box-shadow: inset 0 0 24px color-mix(in srgb, var(--accent) 50%, transparent);
  }
}

@media (max-width: 768px) {
  .pet-teleporter {
    width: 58px;
    height: 58px;
  }
}

/* ── Beam column ─────────────────────────────────── */
.pet-beam-column {
  position: fixed;
  z-index: 10000;
  width: 40px;
  pointer-events: none;
  background: linear-gradient(to top,
    color-mix(in srgb, var(--accent) 50%, transparent),
    color-mix(in srgb, var(--accent) 20%, transparent) 60%,
    transparent);
  box-shadow: 0 0 12px color-mix(in srgb, var(--accent) 30%, transparent),
              0 0 24px color-mix(in srgb, var(--accent) 15%, transparent);
  animation: beam-column-pulse 0.8s ease-out forwards;
  transform-origin: bottom center;
}

@keyframes beam-column-pulse {
  0% { transform: scaleY(0.2); opacity: 0; }
  30% { opacity: 1; }
  100% { transform: scaleY(1); opacity: 1; }
}

/* ── Beam-up animation (pet dissolves upward) ────── */
.pet-beaming-up .pet-sprite {
  animation: pet-beam-up 1s ease-in forwards !important;
}

@keyframes pet-beam-up {
  0% { filter: brightness(1); transform: scaleY(1) translateY(0); opacity: 1; }
  40% { filter: brightness(2); transform: scaleY(1) translateY(-5px); opacity: 1; }
  70% { filter: brightness(3); transform: scaleY(0.5) translateY(-20px); opacity: 0.6; }
  100% { filter: brightness(4); transform: scaleY(0.1) translateY(-40px); opacity: 0; }
}

/* ── Beam-down animation (pet materializes) ──────── */
.pet-beaming-down .pet-sprite {
  animation: pet-beam-down 1s ease-out forwards !important;
}

@keyframes pet-beam-down {
  0% { filter: brightness(4); transform: scaleY(0.1) translateY(-40px); opacity: 0; }
  30% { filter: brightness(3); transform: scaleY(0.5) translateY(-20px); opacity: 0.6; }
  60% { filter: brightness(2); transform: scaleY(1) translateY(-5px); opacity: 1; }
  100% { filter: brightness(1); transform: scaleY(1) translateY(0); opacity: 1; }
}

/* ── Beam sparkle particles ──────────────────────── */
.pet-beam-sparkle {
  position: fixed;
  z-index: 10001;
  width: 3px;
  height: 3px;
  background: var(--accent);
  border-radius: 50%;
  pointer-events: none;
  box-shadow: 0 0 4px var(--accent);
  animation: beam-sparkle-fly 0.8s ease-out forwards;
}

@keyframes beam-sparkle-fly {
  0% { opacity: 1; transform: translate(0, 0) scale(1); }
  100% { opacity: 0; transform: translate(var(--beam-dx), var(--beam-dy)) scale(0); }
}

/* ── Dirt trail cosmetic ──────────────────────── */
.pet-dirt-particle {
  position: fixed;
  z-index: 9996;
  width: 3px;
  height: 3px;
  border-radius: 50%;
  background: #8B6914;
  pointer-events: none;
  animation: dirt-fade 0.8s ease-out forwards;
}

@keyframes dirt-fade {
  0% { opacity: 0.6; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.3); }
}


/* ── Pet toggle button (in header) ─────────── */
.pet-toggle {
  background: transparent;
  border: 1px solid color-mix(in srgb, var(--foreground) 30%, transparent);
  color: color-mix(in srgb, var(--foreground) 60%, transparent);
  padding: 2px 6px;
  font: inherit;
  font-size: 0.75em;
  cursor: pointer;
  margin-left: 4px;
}

.pet-toggle:hover {
  color: var(--accent);
  border-color: var(--accent);
}
