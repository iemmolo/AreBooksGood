{{ define "main" }}
  <h1 class="page-title">{{ .Title }}</h1>
  <div class="casino-intro">
    {{ .Content }}
  </div>

  <div class="casino-tile-grid">
    <a href="{{ "games/poker/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        â™  â™¥<br>â™¦ â™£
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> poker</span>
    </a>

    <a href="{{ "games/blackjack/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        A â™ <br>10 â™¥
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> blackjack</span>
    </a>

    <a href="{{ "games/casino-wars/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        â™  vs â™¦
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> casino wars</span>
    </a>

    <a href="{{ "games/slots/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        ğŸ’ ğŸ’ 7ï¸âƒ£
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> slots</span>
    </a>

    <a href="{{ "games/flappy/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">~|&nbsp;&nbsp;|~<br>~| >|~</div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> flappy bird</span>
    </a>

    <a href="{{ "games/wordle/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        ğŸŸ©ğŸŸ¨â¬›<br>ğŸŸ©ğŸŸ©ğŸŸ©
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> wordle</span>
    </a>

    <a href="{{ "games/sudoku/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        9 &nbsp; 3<br>&nbsp; 5 &nbsp;
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> sudoku</span>
    </a>

    <a href="{{ "games/doodle-jump/" | relURL }}#dj-game-area" class="casino-tile">
      <div class="casino-tile-visual">
        &nbsp; ^ &nbsp;<br>===&nbsp;===
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> doodle jump</span>
    </a>

    <a href="{{ "games/trebuchet/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        &nbsp;/&nbsp;&nbsp;<br>O&#8212;+&#8212;&#9679;
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> trebuchet</span>
    </a>
  </div>

  <script>
  (function () {
    var PET_KEY = 'arebooksgood-pet';
    var SPRITE_SIZE = 16;
    var SCALE = 2;

    try {
      var raw = localStorage.getItem(PET_KEY);
      if (!raw) return;
      var ps = JSON.parse(raw);
      if (!ps.activePet || !ps.pets || !ps.pets[ps.activePet]) return;
      var petId = ps.activePet;
      var level = ps.pets[ps.activePet].level || 1;

      var xhr = new XMLHttpRequest();
      xhr.open('GET', '/data/petsprites.json', true);
      xhr.onload = function () {
        if (xhr.status !== 200) return;
        var data;
        try { data = JSON.parse(xhr.responseText); } catch (e) { return; }

        var frames = resolveFrames(data, petId, level, 'idle');
        if (!frames || !frames.length) return;
        var grid = frames[0];

        var containers = document.querySelectorAll('.casino-tile-pet');
        for (var i = 0; i < containers.length; i++) {
          renderSprite(containers[i], grid);
        }
      };
      xhr.send();
    } catch (e) {}

    function resolveFrames(data, pid, lvl, anim) {
      var pd = data[pid];
      if (!pd) return null;
      var ld = pd[String(lvl)];
      if (!ld) return null;
      var f = ld[anim];
      if (typeof f === 'string') {
        if (f.indexOf('.') !== -1) {
          var p = f.split('.');
          return resolveFrames(data, p[0], parseInt(p[1], 10), anim);
        }
        return resolveFrames(data, pid, parseInt(f, 10), anim);
      }
      return f;
    }

    function renderSprite(container, grid) {
      var shadows = [];
      for (var i = 0; i < grid.length; i++) {
        if (grid[i] === 0) continue;
        var px = i % SPRITE_SIZE;
        var py = Math.floor(i / SPRITE_SIZE);
        var color = grid[i] === 1 ? 'var(--foreground)' : grid[i] === 3 ? 'var(--pet-accessory)' : 'var(--accent)';
        shadows.push((px * SCALE) + 'px ' + (py * SCALE) + 'px 0 0.5px ' + color);
      }
      var el = document.createElement('div');
      el.className = 'casino-tile-pet-pixel';
      el.style.width = SCALE + 'px';
      el.style.height = SCALE + 'px';
      el.style.boxShadow = shadows.join(',');
      container.appendChild(el);
    }
  })();
  </script>
{{ end }}
