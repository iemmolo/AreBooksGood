{{ define "main" }}
  <h1 class="page-title">{{ .Title }}</h1>
  <div class="casino-intro">
    {{ .Content }}
  </div>

  <div class="casino-tile-grid">
    <a href="{{ "games/poker/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        ‚ô† ‚ô•<br>‚ô¶ ‚ô£
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> poker</span>
    </a>

    <a href="{{ "games/blackjack/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        A ‚ô†<br>10 ‚ô•
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> blackjack</span>
    </a>

    <a href="{{ "games/casino-wars/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        ‚ô† vs ‚ô¶
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> casino wars</span>
    </a>

    <a href="{{ "games/slots/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        üçí üíé 7Ô∏è‚É£
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> slots</span>
    </a>

    <a href="{{ "games/flappy/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">~|&nbsp;&nbsp;|~<br>~| >|~</div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> flappy bird</span>
    </a>

    <a href="{{ "games/wordle/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        üü©üü®‚¨õ<br>üü©üü©üü©
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> wordle</span>
    </a>

    <a href="{{ "games/sudoku/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        9 &nbsp; 3<br>&nbsp; 5 &nbsp;
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> sudoku</span>
    </a>

    <a href="{{ "games/doodle-jump/" | relURL }}#dj-game-area" class="casino-tile">
      <div class="casino-tile-visual">
        &nbsp; ^ &nbsp;<br>===&nbsp;===
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> doodle jump</span>
    </a>

    <a href="{{ "games/trebuchet/" | relURL }}" class="casino-tile">
      <div class="casino-tile-visual">
        &nbsp;/&nbsp;&nbsp;<br>O&#8212;+&#8212;&#9679;
      </div>
      <div class="casino-tile-pet"></div>
      <span class="casino-tile-label">> trebuchet</span>
    </a>
  </div>

  <script>
  (function () {
    var PET_KEY = 'arebooksgood-pet';
    var DISPLAY_SIZE = 32;

    try {
      var raw = localStorage.getItem(PET_KEY);
      if (!raw) return;
      var ps = JSON.parse(raw);
      if (!ps.activePet || !ps.pets || !ps.pets[ps.activePet]) return;
      var petId = ps.activePet;
      var level = ps.pets[ps.activePet].level || 1;

      var spriteId = petId;
      var catXhr = new XMLHttpRequest();
      catXhr.open('GET', '/data/petcatalog.json', true);
      catXhr.onload = function () {
        if (catXhr.status === 200) {
          try {
            var cat = JSON.parse(catXhr.responseText);
            if (cat.creatures && cat.creatures[petId]) spriteId = cat.creatures[petId].spriteId || petId;
          } catch (e) {}
        }
        loadSprites();
      };
      catXhr.onerror = function () { loadSprites(); };
      catXhr.send();

      function loadSprites() {
        var xhr = new XMLHttpRequest();
        xhr.open('GET', '/data/petsprites.json', true);
        xhr.onload = function () {
          if (xhr.status !== 200) return;
          var data;
          try { data = JSON.parse(xhr.responseText); } catch (e) { return; }

          var pd = data[spriteId];
          if (!pd || !pd.sheet) return;

          var containers = document.querySelectorAll('.casino-tile-pet');
          for (var i = 0; i < containers.length; i++) {
            renderSprite(containers[i], pd, level);
          }
        };
        xhr.send();
      }
    } catch (e) {}

    function renderSprite(container, pd, level) {
      var fw = pd.frameWidth || 48;
      var fh = pd.frameHeight || 48;
      var frames = pd.frames || 3;
      var frameOffset = pd.frameOffset || 0;
      var frameIdx = Math.min(frameOffset + (level || 1) - 1, frames - 1);
      var scale = DISPLAY_SIZE / fw;

      var el = document.createElement('div');
      el.className = 'casino-tile-pet-sprite';
      el.style.width = DISPLAY_SIZE + 'px';
      el.style.height = DISPLAY_SIZE + 'px';
      el.style.backgroundImage = 'url(' + pd.sheet + ')';
      el.style.backgroundSize = (fw * frames * scale) + 'px ' + (fh * scale) + 'px';
      el.style.backgroundPosition = '-' + (frameIdx * fw * scale) + 'px 0';
      el.style.imageRendering = 'pixelated';
      container.appendChild(el);
    }
  })();
  </script>
{{ end }}
